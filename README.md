# wechatMiniprogramInformationQuery

<style>
table {margin: auto;}3
</style>

 基于微信小程序的北邮信息门户实时查询系统
 
开发人员：

|负责内容|姓名|邮箱|
|--|--|--
|项目负责/后端开发| LIN Guocheng| lgc0208@bupt.edu.cn|
 |前端开发/云开发：| PAN Zaihao| pzhbupt0911@163.com
 
 
# 1 项目目标
目前项目目标都已经实现。
## 1.1 基础目标
（1）实现北邮信息门户校内通知、学术讲座、公示公告、校园新闻的查询 
（2）将从北邮信息门户校内通知、学术讲座、公示公告、校园新闻的内容更新到数据库 
（3）将微信小程序与数据库进行连接，使得小程序可以实时调取数据库内容 
（4）在微信小程序上实现搜索功能 
（5）在微信小程序上实现用户登录功能 
## 1.2 进阶目标
（1）用户可以在微信小程序上对重要通知进行收藏和取消收藏 
（2）将用户收藏的通知与用户微信号挂钩，使用户可以随时读取自己收藏的内容

# 2 技术栈
1. 微信小程序
 用户“无需下载，用完即走”，增加了用户使用的便捷性
 不受手机操作系统的限制，只需要开发一套程序
2. 腾讯云
 支撑微信小程序云开发，可以将数据操作与用户绑定

3. JAVA 服务器
 开发的服务器稳定性和安全性都在长期实践中被得以证明

4. Microsoft SQL Server 数据库
 具备完全Web支持，具有易用性和良好的性价比

5. Python 
 具有海量的第三方库，实现功能迅速、稳定、便捷

# 3 设计思想
整个系统被划分为四个部分：Python 爬虫程序、Microsoft SQL Server 数据库、Java Web的Tomcat 以及微信小程序。划分基于每一个部分对系统的贡献和使用的语言。

Python 由于其具有海量的第三方库，可以迅速、稳定、便捷地实现爬虫程序和数据库的更新，因此选用Python 作为数据的获取和处理部分的主要语言。

Microsoft SQL Server 的是一个具备完全Web 支持的数据库产品，提供了对可扩展标记语言(XML)的核心支持以及在Internet 上和防火墙外进行查询的能力，具有易用性和良好的性价比，这些都是我们选择其作为数据库的原因。

Java 用于Web 开发具有天然的优势。长期以来Java 开发者为其提供了良好的开发基础，使得其具有成熟的设计模式，而且还有成熟的框架，可以用很多表达式以及标签来展示我们需要的内容；Java 开发的稳定性和安全性都在长期实践中被得以证明，因此我们选用Java 作为连接数据库和微信小程序的程序设计语言。

微信小程序从出生以来一直受到开发者的青睐，其背靠10 亿+微信用户，用户“无需下载，用完即走”，增加了用户使用的便捷性，降低了使用门槛。此外，微信小程序的开发不受手机操作系统的限制，只需要开发一套程序即可在不同操作系统的手机进行展示。基于此，我们使用微信小程序作为我们的前端展示工具。

# 4 模块设计
## 4.1 Python爬虫及数据库更新模块
该部分包含一个portalToSQL 类。该类用于将门户中特定的消息更新到Microsoft SQL Server 数据库中。

该类中包含四个功能函数，其中getLt(str) 函数用于从loginUrl 里获取本次登录所特有的参数，如lt， execution 等； getNewsDetaill(objectUrl, session) 函数用于获得所需要爬取的页面的标题、日期和文章主体； toSqlServer(df) 函数用于将df 写入database 数据库的lablename 表中； getInformation() 函数用于将所需要爬取的信息保存到SQL Server 数据库。

该部分的接口描述如下

| 接口名称 | 输入信息 |输出信息|异常处理|
|--------|--------|--|--|
|   toSqlServer  |   需要存入数据库的DataFrame 类型数据df     |None|Try: 将数据插入对应表中Except: 无法插入，则提示插入数据失败，并显示报错结果|
|getInformaion|登录页面的URL、登录页面后获得的cookie、需要爬取消息列表对应的URL、需要爬取的消息对应的Href、对应的数据库中的表名|获取的URL和是否成功插入数据|Try: 成功获取信息Except: 获取失败，则提示执行失败的模块，并显示报错结果|

## 4.2 JAVA Tomcat服务器模块
该部分包含9 个类，该模块接口描述如下

|接口名称|输入信息|输出信息|异常处理|
|--|--|--|--|
|informationDatabase |需要连入的数据库及列表名|查询到的数据结果|Try: 将数据存入数组中 Except: 无法存入，则提示失败，并显示报错结果|
|userDatabase |需要连入的数据库及列表名|查询到的数据结果|Try: 将数据存入数组中 Except: 无法存入，则提示失败，并显示报错结果|
|http://localhost:8080/userServer/userServlet|用户名username 密码password|成功：success 失败：error|Try：在网页上显示数据内容 Except：打印错误报告|
|http://localhost:8080/articleServer/notificationServlet |None| 返回对应JSON数据|Try：在网页上显示数据内容 Except：打印错误报告|
|http://localhost:8080/articleServer/newsServlet |None |返回对应JSON数据|Try：在网页上显示数据内容 Except：打印错误报告|
|http://localhost:8080/articleServer/announcementServlet| None |返回对应JSON数据|Try：在网页上显示数据内容 Except：打印错误报告|
|http://localhost:8080/articleServer/lectureServlet |None| 返回对应JSON数据| Try：在网页上显示数据内容 Except：打印错误报告|

返回的JSON参数格式如下表所示

|参数名 |参数类型 |说明| 注意事项|
|--|--|--|--|
|title |String| 信息标题 |None|
|date |String |信息发布日期 |若为学术讲座，该部分包含主办学院| 
|article| String |信息主体| None|
|image| Array| 图片的 URL 地址 |None|

## 4.3 前端登录页面
本模块实现登陆功能。用户输入用户名（学号）与密码，前端进行简单的表单校验后， 通过 login 接口将数据传到数据库进行账号与密码的比对，如果成功的话，将跳转到消息页 面，反之将提醒用户账号与密码错误。

- 输入：用户名（学号）与密码 
- 输出：登陆成功与否的信息 
- 异常处理：用户名或密码为空时，前端将告知用户名或密码为空，这时数据将不被传到后端

## 4.4 前端信息展示模块
渲染效果上，利用组件 mp-cells & mp-cell 组件为用户带来一致的视觉体验。将事先设 计一个信息展示的模板（信息详情页），以确保所有的信息都可以规范地展示出来，让用户 的视觉体验更加统一。 

逻辑实现上，四种类型的消息每一个都对应着一个列表。运用条件渲染语句 wx:for（类 似于 C/C++中的 for 语句）来对列表数据进行循环渲染，以实现消息的展示效果。使用搜索 时，利用条件渲染语句 wx:if 将主页面隐藏，只留下搜索部分。利用 JS 的字符串方法将搜 索内容与全局消息进行匹配，将结果放入列表当中，由条件渲染语句 wx:for 来展示。当用 户点击对应信息后，由小程序自带的函数来获取这条消息对应的列表索引。获取这条消息的 详情信息，随后携带其详情信息跳转到信息详情页。

## 4.5 前端个人信息展示模块
本模块展示用户的个人信息。同时提供用户个人收藏消息的管理

## 4.6 前端收藏管理模块
本模块提供收藏模块的管理功能（查看收藏的消息，或者对消息取消收藏），分为信息的展示页以及信息详情页两部分。

# 5 数据库与数据结构设计
本系统内使用的数据库系统为 Microsoft SQL Server 2019 数据库，数据库中包含表 User, schoolAnnouncements, schoolArticles, schoolLectures 和 schoolNews 五张表，分别用于 用户登录鉴权、公告公示、校内通知、学术讲座和校内新闻的存储。

五张表中，User 表的数据结构设计如下表所示

|列名 |数据类型 |允许 Null 值|
|--|--|--|
|username |nchar(10) |√|
|password| ntext| √|

schoolAnnouncements, schoolArticles, schoolLectures 和 schoolNews 表的数据结构设计如下表所示

|列名 |数据类型 |允许 Null 值|
|--|--|--|
|title| nvarchar(50) |√ |
|date| nvarchar(50)| √ |
|article| ntext| √|
|image| ntext| √|

数据存储设计：
- 访问方法：程序登录数据库后，通过 SQL 语句直接取用；
- 每次取用整组数据，对整组数据进行搜索，最终将得到的数据在程序中处理；
- 所有数据存储在电脑硬盘中，由程序按期删除；
- 数据库内容的保密通过连接数据库时所使用的用户名、密码所对应的权限来进行区分。